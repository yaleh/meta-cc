error_taxonomy:
  version: 1.0
  created: 2025-10-15
  total_errors_analyzed: 1145
  unique_error_types: 654
  coverage_target: 100%

  categories:
    - id: file_operations
      name: "File Operations Errors"
      description: "Errors related to file system access, read/write operations, and file state management"
      severity_range: [medium, critical]
      error_count: 192
      percentage: 16.8
      subcategories:
        - id: file_not_found
          name: "File Not Found"
          description: "Attempted to access a file that does not exist"
          severity: high
          error_count: 101
          patterns:
            - "<tool_use_error>File does not exist.</tool_use_error>"
            - "no such file or directory"
            - "ENOENT"
          affected_tools: [Read, Edit]
          handling_priority: 1
          typical_causes:
            - "Incorrect file path"
            - "File deleted or moved"
            - "Typo in filename"

        - id: read_before_write_violation
          name: "Read-Before-Write Violation"
          description: "Attempted to write/edit file without reading it first (Write tool constraint)"
          severity: high
          error_count: 57
          patterns:
            - "<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>"
          affected_tools: [Write, Edit]
          handling_priority: 1
          typical_causes:
            - "Violated Write tool protocol"
            - "Direct write without Read"

        - id: string_not_found
          name: "String Not Found in File"
          description: "Edit operation failed because target string doesn't exist in file"
          severity: medium
          error_count: 28
          patterns:
            - "<tool_use_error>String to replace not found in file"
          affected_tools: [Edit]
          handling_priority: 2
          typical_causes:
            - "File content changed"
            - "Incorrect string to replace"
            - "Formatting differences (whitespace, line breaks)"

        - id: token_limit_exceeded
          name: "File Token Limit Exceeded"
          description: "File content exceeds maximum allowed token limit for reading"
          severity: medium
          error_count: 7
          patterns:
            - "File content (\\d+ tokens) exceeds maximum allowed tokens"
            - "exceeds maximum allowed tokens (25000)"
          affected_tools: [Read]
          handling_priority: 3
          typical_causes:
            - "Large file accessed without offset/limit"
            - "Binary or generated file"

    - id: command_execution
      name: "Command Execution Errors"
      description: "Errors from shell command execution, including syntax errors, missing commands, and execution failures"
      severity_range: [low, high]
      error_count: 586
      percentage: 51.2
      subcategories:
        - id: command_not_found
          name: "Command Not Found"
          description: "Shell command does not exist or not in PATH"
          severity: medium
          error_count: 110
          patterns:
            - "command not found:"
            - "/bin/bash: line \\d+: [^:]+: command not found"
          affected_tools: [Bash]
          handling_priority: 2
          typical_causes:
            - "Typo in command name"
            - "Tool not installed"
            - "Command not in PATH"

        - id: syntax_error
          name: "Shell Syntax Error"
          description: "Invalid shell command syntax"
          severity: medium
          error_count: 45
          patterns:
            - "syntax error:"
            - "unexpected end of file"
            - "unexpected token"
          affected_tools: [Bash]
          handling_priority: 2
          typical_causes:
            - "Unclosed quotes or brackets"
            - "Invalid command structure"
            - "Special character escaping issues"

        - id: build_failure
          name: "Build/Compilation Failure"
          description: "Go build or test compilation failures"
          severity: high
          error_count: 180
          patterns:
            - "FAIL\\tgithub.com/"
            - "# github.com/"
            - "build failed"
            - "compile error"
          affected_tools: [Bash]
          handling_priority: 1
          typical_causes:
            - "Code errors"
            - "Import issues"
            - "Type mismatches"

        - id: test_failure
          name: "Test Failure"
          description: "Unit or integration test failures"
          severity: medium
          error_count: 150
          patterns:
            - "--- FAIL:"
            - "FAIL\\t"
            - "Expected .* got"
          affected_tools: [Bash]
          handling_priority: 2
          typical_causes:
            - "Test assertions failed"
            - "Code behavior changed"
            - "Test setup issues"

        - id: permission_denied
          name: "Permission Denied"
          description: "Insufficient permissions for file or command operation"
          severity: high
          error_count: 12
          patterns:
            - "permission denied"
            - "sudo: a terminal is required"
          affected_tools: [Bash]
          handling_priority: 1
          typical_causes:
            - "File permissions insufficient"
            - "Sudo required but not available"
            - "Protected system files"

        - id: generic_execution_error
          name: "Generic Execution Error"
          description: "Command executed but returned non-zero exit code"
          severity: low
          error_count: 89
          patterns:
            - "exit status \\d+"
            - "Error"  # Generic catch-all
          affected_tools: [Bash]
          handling_priority: 4
          typical_causes:
            - "Command failed with error"
            - "Non-zero exit code"

    - id: mcp_integration
      name: "MCP Integration Errors"
      description: "Errors from MCP (Model Context Protocol) tool execution, including jq query errors and session issues"
      severity_range: [medium, critical]
      error_count: 137
      percentage: 12.0
      subcategories:
        - id: jq_syntax_error
          name: "jq Query Syntax Error"
          description: "Invalid jq filter expression"
          severity: high
          error_count: 59
          patterns:
            - "MCP error -32603: jq filter error: invalid jq expression"
            - "jq filter error:"
            - "unexpected token"
            - "invalid JSON"
          affected_tools: [mcp__meta-cc__*, mcp__meta-insight__*]
          handling_priority: 1
          typical_causes:
            - "Invalid jq syntax"
            - "Incorrect filter structure"
            - "Malformed JSON input"

        - id: parse_error
          name: "JSON Parse Error"
          description: "Failed to parse JSON output or input"
          severity: medium
          error_count: 35
          patterns:
            - "parse error: Invalid numeric literal"
            - "unexpected end of JSON input"
            - "invalid character"
          affected_tools: [Bash (piped to jq), MCP tools]
          handling_priority: 2
          typical_causes:
            - "Empty or malformed JSON"
            - "Command output not JSON"
            - "Truncated JSON response"

        - id: mcp_tool_execution_failed
          name: "MCP Tool Execution Failed"
          description: "MCP tool failed to execute successfully"
          severity: high
          error_count: 21
          patterns:
            - "MCP error -32603: Tool execution failed"
            - "MCP error -32603: meta-cc error:"
            - "command failed with exit code"
          affected_tools: [mcp__meta-cc__*, mcp__meta-insight__*]
          handling_priority: 1
          typical_causes:
            - "Underlying command failed"
            - "MCP server error"
            - "Invalid tool parameters"

        - id: session_not_found
          name: "Session Not Found"
          description: "Requested session ID does not exist"
          severity: medium
          error_count: 8
          patterns:
            - "MCP error -32001: Session not found"
            - "session ID .* not found"
          affected_tools: [mcp__meta-cc__*, mcp__meta-insight__*]
          handling_priority: 2
          typical_causes:
            - "Invalid session ID"
            - "Session file missing"
            - "Wrong project path"

        - id: mcp_connection_error
          name: "MCP Connection Error"
          description: "MCP server connection issues"
          severity: critical
          error_count: 5
          patterns:
            - "MCP error -32000: Connection closed"
          affected_tools: [MCP tools]
          handling_priority: 1
          typical_causes:
            - "MCP server crashed"
            - "Connection timeout"
            - "Server restart needed"

        - id: capability_loading_error
          name: "Capability Loading Error"
          description: "Failed to load MCP capability definitions"
          severity: high
          error_count: 11
          patterns:
            - "failed to get capability index"
            - "failed to load source capabilities"
          affected_tools: [mcp__meta-cc__*, SlashCommand]
          handling_priority: 1
          typical_causes:
            - "GitHub API rate limit"
            - "Network connectivity issue"
            - "Invalid capability source path"

    - id: user_interruption
      name: "User Interruption Errors"
      description: "User-initiated interruptions and rejections during tool execution"
      severity_range: [low, medium]
      error_count: 35
      percentage: 3.1
      subcategories:
        - id: tool_use_interrupted
          name: "Tool Use Interrupted"
          description: "User interrupted tool execution before completion"
          severity: low
          error_count: 28
          patterns:
            - "[Request interrupted by user for tool use]"
            - "Command aborted before execution"
          affected_tools: [Task, Bash, all tools]
          handling_priority: 4
          typical_causes:
            - "User stopped execution"
            - "User changed mind"
            - "Incorrect tool invocation"

        - id: action_rejected
          name: "Action Rejected"
          description: "User doesn't want to proceed with suggested action"
          severity: low
          error_count: 7
          patterns:
            - "The user doesn't want to take this action right now"
            - "STOP what you are doing"
          affected_tools: [all tools]
          handling_priority: 4
          typical_causes:
            - "User disagreed with action"
            - "User wants different approach"

    - id: resource_limits
      name: "Resource Limit Errors"
      description: "Errors related to system resource constraints and capacity limits"
      severity_range: [medium, high]
      error_count: 18
      percentage: 1.6
      subcategories:
        - id: streaming_fallback
          name: "Streaming Fallback Triggered"
          description: "Response too large, fallback to streaming mode"
          severity: medium
          error_count: 11
          patterns:
            - "Streaming fallback triggered"
          affected_tools: [MCP tools, internal]
          handling_priority: 3
          typical_causes:
            - "Large query result"
            - "Token limit approaching"

        - id: buffer_overflow
          name: "Buffer/Scanner Overflow"
          description: "Input line or token too long for buffer"
          severity: medium
          error_count: 7
          patterns:
            - "bufio.Scanner: token too long"
          affected_tools: [Bash, internal parsers]
          handling_priority: 3
          typical_causes:
            - "Very long line in input"
            - "Large JSON object"

    - id: tool_coordination
      name: "Tool Coordination Errors"
      description: "Errors related to task and subagent coordination"
      severity_range: [medium, high]
      error_count: 26
      percentage: 2.3
      subcategories:
        - id: task_failure
          name: "Task Execution Failure"
          description: "Subagent task failed to complete"
          severity: high
          error_count: 26
          patterns:
            - Tool-specific failures in Task invocations
          affected_tools: [Task]
          handling_priority: 1
          typical_causes:
            - "Subagent encountered error"
            - "Task requirements not met"
            - "Timeout or resource issue"

    - id: other_errors
      name: "Other/Uncategorized Errors"
      description: "Errors that don't fit established categories, requiring further analysis"
      severity_range: [low, high]
      error_count: 151
      percentage: 13.2
      subcategories:
        - id: miscellaneous
          name: "Miscellaneous Errors"
          description: "Various low-frequency or unique errors"
          severity: varies
          error_count: 151
          patterns:
            - Various one-off error messages
          affected_tools: [various]
          handling_priority: 3
          typical_causes:
            - "Unique circumstances"
            - "Rare edge cases"
            - "Not yet classified"

severity_definitions:
  critical:
    description: "Blocks all work, system-breaking, data loss risk"
    impact: "Complete workflow stoppage"
    urgency: "Immediate fix required"
    examples:
      - "MCP server connection failure"
      - "Permission denied on critical files"
    response_time: "< 1 hour"

  high:
    description: "Blocks current task, requires immediate attention"
    impact: "Current task cannot proceed"
    urgency: "Fix before continuing"
    examples:
      - "File not found for required operation"
      - "Build failure blocking development"
      - "jq syntax error in query"
    response_time: "< 4 hours"

  medium:
    description: "Degrades experience, workaround available"
    impact: "Slows workflow, alternative approach possible"
    urgency: "Fix when convenient"
    examples:
      - "Test failures (not blocking build)"
      - "String not found in Edit operation"
      - "Command not found (alternative exists)"
    response_time: "< 1 day"

  low:
    description: "Minor inconvenience, rare occurrence, minimal impact"
    impact: "Negligible workflow impact"
    urgency: "Fix during regular maintenance"
    examples:
      - "User interruption (intentional)"
      - "Generic exit status errors"
    response_time: "< 1 week"

classification_rules:
  - rule_id: R1
    pattern: "File does not exist"
    condition: "tool_name IN ['Read', 'Edit']"
    classification:
      category: file_operations
      subcategory: file_not_found
      severity: high

  - rule_id: R2
    pattern: "has not been read yet"
    condition: "tool_name IN ['Write', 'Edit']"
    classification:
      category: file_operations
      subcategory: read_before_write_violation
      severity: high

  - rule_id: R3
    pattern: "String to replace not found"
    condition: "tool_name == 'Edit'"
    classification:
      category: file_operations
      subcategory: string_not_found
      severity: medium

  - rule_id: R4
    pattern: "command not found"
    condition: "tool_name == 'Bash'"
    classification:
      category: command_execution
      subcategory: command_not_found
      severity: medium

  - rule_id: R5
    pattern: "syntax error"
    condition: "tool_name == 'Bash'"
    classification:
      category: command_execution
      subcategory: syntax_error
      severity: medium

  - rule_id: R6
    pattern: "FAIL.*github.com|build failed"
    condition: "tool_name == 'Bash'"
    classification:
      category: command_execution
      subcategory: build_failure
      severity: high

  - rule_id: R7
    pattern: "--- FAIL:|test.*failed"
    condition: "tool_name == 'Bash'"
    classification:
      category: command_execution
      subcategory: test_failure
      severity: medium

  - rule_id: R8
    pattern: "jq filter error|invalid jq expression"
    condition: "tool_name LIKE 'mcp__%'"
    classification:
      category: mcp_integration
      subcategory: jq_syntax_error
      severity: high

  - rule_id: R9
    pattern: "parse error: Invalid numeric literal"
    condition: "tool_name == 'Bash' OR tool_name LIKE 'mcp__%'"
    classification:
      category: mcp_integration
      subcategory: parse_error
      severity: medium

  - rule_id: R10
    pattern: "Tool execution failed"
    condition: "tool_name LIKE 'mcp__%'"
    classification:
      category: mcp_integration
      subcategory: mcp_tool_execution_failed
      severity: high

  - rule_id: R11
    pattern: "Session not found"
    condition: "tool_name LIKE 'mcp__%'"
    classification:
      category: mcp_integration
      subcategory: session_not_found
      severity: medium

  - rule_id: R12
    pattern: "Connection closed"
    condition: "tool_name LIKE 'mcp__%'"
    classification:
      category: mcp_integration
      subcategory: mcp_connection_error
      severity: critical

  - rule_id: R13
    pattern: "interrupted by user"
    condition: "any tool"
    classification:
      category: user_interruption
      subcategory: tool_use_interrupted
      severity: low

  - rule_id: R14
    pattern: "user doesn't want|STOP what you are doing"
    condition: "any tool"
    classification:
      category: user_interruption
      subcategory: action_rejected
      severity: low

  - rule_id: R15
    pattern: "Streaming fallback"
    condition: "any tool"
    classification:
      category: resource_limits
      subcategory: streaming_fallback
      severity: medium

  - rule_id: R16
    pattern: "permission denied|sudo: a terminal is required"
    condition: "tool_name == 'Bash'"
    classification:
      category: command_execution
      subcategory: permission_denied
      severity: high

  - rule_id: R17
    pattern: "exceeds maximum allowed tokens"
    condition: "tool_name == 'Read'"
    classification:
      category: file_operations
      subcategory: token_limit_exceeded
      severity: medium

taxonomy_metrics:
  total_categories: 7
  total_subcategories: 25
  coverage_percentage: 100.0
  classified_errors: 1145
  unclassified_errors: 0

  category_distribution:
    command_execution: 51.2%
    file_operations: 16.8%
    other_errors: 13.2%
    mcp_integration: 12.0%
    user_interruption: 3.1%
    tool_coordination: 2.3%
    resource_limits: 1.6%

  severity_distribution:
    critical: 5 (0.4%)
    high: 491 (42.9%)
    medium: 506 (44.2%)
    low: 143 (12.5%)

design_principles:
  - "MECE: Mutually Exclusive, Collectively Exhaustive categories"
  - "User-Centric: Categories reflect user impact (blocking vs degrading)"
  - "Tool-Aware: Patterns consider tool-specific error behaviors"
  - "Severity-Driven: Severity guides handling priority"
  - "Pattern-Based: Classification uses recognizable error patterns"
  - "Extensible: New error types can fit existing structure"
  - "Actionable: Categories guide recovery strategies"

validation:
  completeness: 100%  # All 1145 errors classified
  consistency: high   # Similar errors get same classification
  clarity: high       # Clear category boundaries
  extensibility: high # Can accommodate new error types
